{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/carax/Desktop/SideProject/SFDB-Project/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/carax/Desktop/SideProject/SFDB-Project/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/carax/Desktop/SideProject/SFDB-Project/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import axios from'axios';import React,{useState}from'react';import config from'../../config';import{kakaoSocialLogin}from'../../axios/user/loginLogic';import{serialize}from'cookie';import{useNavigate}from'react-router';import{Alert,Snackbar}from'@mui/material';import{useSnackbar}from'notistack';import{getCookie}from'../../utils/getCookies';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var KakaoCallback=function KakaoCallback(){var navigate=useNavigate();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),alertOn=_useState2[0],setAlertOn=_useState2[1];var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var handleClose=function handleClose(){setAlertOn(false);};var kakaoRestAPIKey=config.kakaoClientId;var kakaoRedirectUri=config.kakaoRedirectUri;var urlSearchParams=new URLSearchParams(window.location.search);var code=urlSearchParams.get('code');if(code){var grantType='authorization_code';var data=\"grant_type=\".concat(grantType,\"&client_id=\").concat(kakaoRestAPIKey,\"&redirect_uri=\").concat(kakaoRedirectUri,\"&code=\").concat(code);axios.post('https://kauth.kakao.com/oauth/token',data,{headers:{'Content-Type':'application/x-www-form-urlencoded;charset=utf-8'}}).then(function(res){console.log(res);var data=res.data;var access_token=data.access_token;if(access_token){console.log(\"Bearer \".concat(access_token));axios.post(\"https://kapi.kakao.com/v2/user/me\",{},{headers:{Authorization:\"Bearer \".concat(access_token),\"Content-type\":\"application/x-www-form-urlencoded\"}}).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(res){var kakaoLoginData,response,userName;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:console.log(res.data);kakaoLoginData={id:res.data.id,name:res.data.kakao_account.profile.nickname,email:res.data.kakao_account.email,birth:res.data.kakao_account.birthday,image:res.data.kakao_account.profile.profile_image_url};//서버에 로그인정보 전달\n_context.next=4;return kakaoSocialLogin(kakaoLoginData);case 4:response=_context.sent;if(response===1){console.log(\"카카오 로그인 성공\");document.cookie=serialize('userId',kakaoLoginData.id,{path:'/'});document.cookie=serialize('userName',kakaoLoginData.name,{path:'/'});document.cookie=serialize('userBirth',kakaoLoginData.birth,{path:'/'});document.cookie=serialize('userProfileImage',kakaoLoginData.image,{path:'/'});navigate('/main');userName=getCookie('userName');enqueueSnackbar(\"\".concat(userName,\"\\uB2D8, \\uC5B4\\uC11C\\uC624\\uC138\\uC694.\"),{variant:'success'});setAlertOn(true);}case 6:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());}else{console.log(\"access_token 없음\");enqueueSnackbar('로그인에 실패했습니다.',{variant:'warning'});setAlertOn(true);}}).catch(function(error){console.error('Error exchanging code for access token:',error);enqueueSnackbar('네트워크 오류 발생!',{variant:'error'});setAlertOn(true);});}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Snackbar,{open:alertOn,autoHideDuration:3000,onClose:handleClose,children:/*#__PURE__*/_jsx(Alert,{onClose:handleClose,severity:\"success\",sx:{width:'100%'},children:\"\\uB85C\\uADF8\\uC778\\uC5D0 \\uC131\\uACF5\\uD588\\uC2B5\\uB2C8\\uB2E4!\"})})});};export default KakaoCallback;","map":{"version":3,"names":["axios","React","useState","config","kakaoSocialLogin","serialize","useNavigate","Alert","Snackbar","useSnackbar","getCookie","jsx","_jsx","Fragment","_Fragment","KakaoCallback","navigate","_useState","_useState2","_slicedToArray","alertOn","setAlertOn","_useSnackbar","enqueueSnackbar","handleClose","kakaoRestAPIKey","kakaoClientId","kakaoRedirectUri","urlSearchParams","URLSearchParams","window","location","search","code","get","grantType","data","concat","post","headers","then","res","console","log","access_token","Authorization","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","kakaoLoginData","response","userName","wrap","_callee$","_context","prev","next","id","name","kakao_account","profile","nickname","email","birth","birthday","image","profile_image_url","sent","document","cookie","path","variant","stop","_x","apply","arguments","catch","error","children","open","autoHideDuration","onClose","severity","sx","width"],"sources":["C:/Users/carax/Desktop/SideProject/SFDB-Project/front/src/pages/user/KakaoCallback.jsx"],"sourcesContent":["  import axios from 'axios';\r\n  import React, { useState } from 'react'\r\n  import config from '../../config';\r\nimport { kakaoSocialLogin } from '../../axios/user/loginLogic';\r\nimport { serialize } from 'cookie';\r\nimport { useNavigate } from 'react-router';\r\nimport { Alert, Snackbar } from '@mui/material';\r\nimport { useSnackbar } from 'notistack';\r\nimport { getCookie } from '../../utils/getCookies';\r\n\r\n  const KakaoCallback = () => {\r\n    const navigate = useNavigate();\r\n    const [alertOn, setAlertOn] = useState(false);\r\n    const { enqueueSnackbar } = useSnackbar(); \r\n    const handleClose = () => {\r\n      setAlertOn(false)\r\n    }\r\n  \r\n  \r\n    const kakaoRestAPIKey = config.kakaoClientId;\r\n    const kakaoRedirectUri = config.kakaoRedirectUri;\r\n  \r\n    const urlSearchParams = new URLSearchParams(window.location.search);\r\n    const code = urlSearchParams.get('code');\r\n    \r\n    if (code) {\r\n      const grantType = 'authorization_code';\r\n      const data = `grant_type=${grantType}&client_id=${kakaoRestAPIKey}&redirect_uri=${kakaoRedirectUri}&code=${code}`;\r\n      axios\r\n        .post('https://kauth.kakao.com/oauth/token', data, {\r\n          headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',\r\n          },\r\n        })\r\n        .then((res) => {\r\n          console.log(res);\r\n          const { data } = res;\r\n  const { access_token } = data;\r\n  if(access_token) {\r\n  console.log(`Bearer ${access_token}`);\r\n  axios\r\n      .post(\r\n          \"https://kapi.kakao.com/v2/user/me\",\r\n          {},\r\n          {\r\n            headers: {\r\n              Authorization : `Bearer ${access_token}` ,\r\n              \"Content-type\" : \"application/x-www-form-urlencoded\",\r\n              },\r\n          }\r\n        )\r\n        .then(async (res) => {\r\n        console.log(res.data)\r\n        const kakaoLoginData = {\r\n          id : res.data.id,\r\n          name : res.data.kakao_account.profile.nickname,\r\n          email : res.data.kakao_account.email,\r\n          birth : res.data.kakao_account.birthday,\r\n          image : res.data.kakao_account.profile.profile_image_url\r\n        }\r\n\r\n        //서버에 로그인정보 전달\r\n        const response = await kakaoSocialLogin(kakaoLoginData)\r\n        if(response === 1 ){\r\n          console.log(\"카카오 로그인 성공\");\r\n          document.cookie = serialize('userId' , kakaoLoginData.id , {path : '/'})\r\n          document.cookie = serialize('userName' , kakaoLoginData.name , {path : '/'})\r\n          document.cookie = serialize('userBirth' , kakaoLoginData.birth , {path : '/'})\r\n          document.cookie = serialize('userProfileImage' , kakaoLoginData.image , {path : '/'})\r\n          navigate('/main')\r\n          const userName = getCookie('userName')\r\n          enqueueSnackbar(`${userName}님, 어서오세요.`, { variant: 'success' });\r\n          setAlertOn(true);\r\n        }\r\n      });\r\n      } else {\r\n      console.log(\"access_token 없음\");\r\n      enqueueSnackbar('로그인에 실패했습니다.', { variant: 'warning' });\r\n      setAlertOn(true);\r\n  }\r\n        })\r\n        .catch((error) => {\r\n          console.error('Error exchanging code for access token:', error);\r\n          enqueueSnackbar('네트워크 오류 발생!', { variant: 'error' });\r\n          setAlertOn(true);\r\n        });\r\n    }\r\n\r\n    return (\r\n      <>\r\n              <Snackbar open={alertOn} autoHideDuration={3000} onClose={handleClose}>\r\n          <Alert onClose={handleClose} severity=\"success\" sx={{ width: '100%' }}>\r\n            로그인에 성공했습니다!\r\n          </Alert>\r\n        </Snackbar>\r\n      </>\r\n    )\r\n  }\r\n\r\n  export default KakaoCallback"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}